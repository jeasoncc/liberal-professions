# 重构与架构

[TOC]



## 什么是重构

**重构是指在不改变代码行为的前提下，重写代码，使其更加简洁，易于复用**。如果你正在写代码，那么重构是你应该掌握一项核心技能，因为不管你想不想，有时你都不得不重构代码。你也许已重构过代码，只是自己没有意识到。

##  什么是软件架构

就像生物一样，软件架构通常由很多较小的部件组成，每个部件擅长做一件事。将这些部件组合起来，一起工作，可形成更大的软件架构。**软件架构就是用来描述软件项目的各个不用部件的组合方式。**

从简单的网站都复杂的宇宙飞船控制系统，每一种软件都有自己的架构，不管开发人员有意还是无意为之。然而，最好的软件架构通常在编码工作开始之前做过缜密规划。下面是优秀软件架构所具备的一些最重要的特点。

### 优秀的架构是可预测的

软件架构可预测是指可以对软件的工作方式和结构做出准确的假设。可预测性表明预先的规划是合理的，并有助于节省开发时间，因为可以避免以下问题：

- 组件的功能是什么
- 某一段代码在何处
- 新代码加到何处

在可预测的架构中，人们可以做出精准的假设，不熟悉代码的开发人员也能更快地理解该架构。

### 优秀架构可提升代码复用性

代码复用是指在多处使用同一代码而无需重写。代码复用的优势明显，不用重写已有代码，可以加快开发速度。同理，解决某一问题所需的代码越少，维护所有用该代码实现的功能所需的时间就越少。

### 优秀的可扩展性

可扩展性是优秀架构所遵循的一项原则，在具备该特点的系统上增加新功能很容易。大多数软件无法在一天内开发完成，因此软件架构适于增量开发，且不需要做大的结构性变化，这一点非常的重要。如果项目开发过程需要频繁地对架构做出较大的改动，发布将十分困难。

### 优秀架构可维护

与可扩展性非常类似，可维护性对于架构也很重要。对于可和维护的优秀架构，修改其现有功能很容易，随着时间的推进，需求也许会发生改变。迫于需求变动的压力，你将修改代码。可维护性是指你修改一处代码的时候，没必要大规模的改动代码。

### 软件架构和重构

重构有助于维护和提升软件架构。重构就是指调整代码结构，使其更具有意义。重构的目标是使代码可预测、可复用、可扩展和可维护。当你的软件架构具备了上述特点轼，它对目标用户而言将更可靠，你在其上继续开发也会更愉快。

## 需要重构的原因

为什么当初不把代码写正确，这样日后不就没有必要重构代码了？尽管我们一心想涉及和编写最高质量的代码，但是随着时间的推移，一些因素将发生变化，导致需要重构代码。

###  需求变更

**软件系统随着需求的变动而进化，软件在编写时是为了满足一组需求，没有考虑另一组没有的需求**。因此，需求变更时，代码也必须随着改变。此外，如果软件开发还有时间要求，有时会为优先满足功能的实现而走「捷径」，进而可能影响代码质量。

### 架构设计不合理

**即使你知道什么是优秀架构，投入大量的时间事先规划好一切并不总是可行的**。开发之初，你若不知道各组件的组合方式，开发过程也许需要重构。非常常见的做法是，快速开发一个新功能，以验证它对用户是否有吸引力。如确实能够吸引用户，再将代码整理干净，如达不到预期结果，则删除代码。

### 低估困难

预估软件开发需要多长时间，但不幸的是，<u>我们常常根据估计结果来安排开发计划。如果项目开发周期被低估，将迫使开发人员「为了完成而完成」，导致他们快速编写代码，而不会花费很多时间思考。</u>

### 忽视最佳实践

跟上每一种最佳实践的发展步伐很难，当你的工作涉及多种技术和人员管理时更是如此。如果你们是一个团队协同工作，而你忽视了最佳实践，需要明白技术债务将随着时间的发展而增加。

## 什么时候下应该重构技术代码

