## 分析 JavaScript 

JavaScript 建立在一些非常好的想法和少数非常坏的想法之上。

那些非常好的想法包括**函数**、**弱类型**、**动态对象**和一个富有表现力的**对象字面量**表示法。那些坏的想法包括基于全局变量的编程模型。

**JavaScript 的函数主要是基于词法作用域的顶级对象**。<u>JavaScript 是第一个成为主流的 lambda 的语言</u>。实际上，相对 Java 而言，JavaScript 与 Lisp 和 Scheme 有更多的共同点。它是披着 C 语言外衣的 Lisp。这使得 JavaScript 成为一个非常强大的语言。

**现今大部分编程中都流行的要求强类型，其原理在于强类型允许编译器在编译时检测错误。**我们能越检测和修复错误。付出的代价就越小。 JavaScript 是一门弱类型的语言，所以 JavaScript 编译器不能检测出类型错误。这可能让从强类型语言转向 JavaScript 的开发人员感到恐慌。但事实证明，强类型并不会让你的测试工作轻松。并且我在工作中发现，强类型检查找到的那种错误并不是令我头痛的错误。另一方面，我发现弱类型是自由的。我无须建立复立的类层次，我永远不用做强制造型。也不用疲于应付类型系统想要的行为。建立

JavaScript 有非常强大的对象在字面量表示法。通过列出对象的组成部分，它们就能简单地被创建出来。

原型继承是 JavaScript 中有一个有争议的特性。 JavaScript 有一个无类别的对象系统，在这个系统中，**对象直接从其他对象继承属性**。这真的很强大，但是对那些被训练使用类去创建对象的程序员来说，原型继承是一个陌生的概念。如果你尝试对 JavaScript 直接应用基于类的设计模式，你将会遭受挫折。但是，如果你学习使用 JavaScript的原型本质，那么你的努力会有所回报。

JavaScript 在关键思想的选择上饱受非议。虽然在大多数情况下，这些选择是合适的。但是有一个选择相当糟糕；**JavaScript 依赖于全局变量来进行连接**。所有的编译单元的所有顶级变量被撮合到一个被称为全局对象的公共命名空间中。这是一件糟糕的事情，因为全局变量是魔鬼，并且在 JavaScript 中它们是基础性的。幸好，我们也看到 JavaScript 也给我们提供了缓解这个问题的方法。

JavaScript 是一门有许多差异的语言。它包含很多错误和尖锐的边角，所以你可能会疑惑：「为什么我要使用 JavaScript 」有两个答案。第一个是你没有选择。 WEB 已变成一个重要的应用开发平台，而 JavaScript 是唯一一门所有浏览器都可以识别的语言。很不幸，Java 在浏览器都可以识别的语言。否则想用强类型语言的人就有其他的选择了。但是 Java 确实失败了，而 JavaScript 仍蓬勃发展着，这恰恰说明 JavaScript 确有其过人之处。

另一个答案，尽管 JavaScript 有缺陷，但是它真的很优秀，它既轻量级又富有表现力。并且一旦你熟练掌握了它，就会发现函数式编程是一件很有趣的事。

但是为了更好使用这门语言，你必须知道它的局限，我将会无情地揭示它们。不要因此而气馁。这门语言的精华部分足以弥补它鸡肋的不足。

## 一个简单的 DEMO 

如果你有一个 WEB 浏览器和任意一个文本编辑器，那么你就有一个运行了 JavaScript 程序所需要的一切。首先，请创建一个 HTML 文件，可以命名为 program.html

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <pre>
        <script src="program.js"></script>
    </pre>
</body>
</html>
```

接下来，在同一个文件夹里，创建一个脚本文件，可以命名为 program.js

```javascript
document.writeln('hello world!')
```

### 空白

空白可能表现为格式化字符或注释的形式。空白通常没有意义，但是偶尔需要用它来分隔自符序列，否则它们就会被合并成一个单一的身上符号

```js
var that = this
```

var 和 that 之间的空格是不能被移除的，但是其他的空格都可以被移除。

### 注释

JavaScript 提供两种注释形式，一种是用 /* */ 包围的块注释，另一种是以 // 开头的行注释，注释应该被充分的用来提高程序的可读性。必须注意的是，注释一定要精确地描述代码。没有用的注释比没有注释更糟糕。

用 /* */ 包围的块注释形式来自于一门叫 PL/I 的语言。 PL/I 选择那些不常见的符号作为注释的符号标志，因为它们除了可能出现在字符串的字面上之外，不大可能在这门语言的程序中出现。在 JavaScript 中，那些字符也可能出现在正则表达式字面上，所以块注释对于被注释的代码块来说是不安全的。

```js
/* 
    var rm_a = /a*/.match(s)
*/
```

导致了一个语法错误，所以，我建议避免使用 /* */ 注释，而用 // 注释代替它。

### 标识符

标识符由一个字母开头，其后可选择性地加上一个或多个字母、数字或下划线。标识符不能使用下面这些保留字。

```java
abstract 
boolean
break
byte
case
catch
char
class
const
continue
debugger
default
delete
do
double
else
enum
export
extends
false
final
final
finally
float 
finally 
float 
for 
……
```

在这个列表中大部分保留字尚未用在这门语言中，这个列表不包括一些本应该被保留而没有保留的字，诸如 undefined， NaN 和 Infinity 。JavaScript 不允许使用保留字，JavaScript 不允许使用保留字来命明变量或参数。更糟糕的是，JavaScript 不允许在对象字面量中，或者在一个属性存取表达式的点号之后，使用保留字作为对象的属性名。

标识符被用于语句、变量、参数、属性名、运算符和标记。

### 数字

JavaScript 只有一个单一的数字类型，它**在内部被表示为 64 位的浮点数**，和 Java 的 double 一样。不像大多数其他的编程语言，它没有分离出整数类型，所以 1 和 1.0 是相同的值。这提供了很大的方便，因为它**完全避免了短整数的溢出问题**，并且你需要知道的关于数字的一切就是它的一种数字，这样就避免了因数字类型导致的错误。

如果一个数字字面量有指数部分，那么这个字面量的值是由 e 之前的部分乘以 10 的 e 之后部分的次方计算出来的。所以 100 和 le2 是相同的数字。

负数可以用前缀运算符 - 来构成。

值 **NaN 是一个数值，它表示一个不能产生正常结果的运算结果**。<u>NaN 不等于任何值，包括它自己</u>。你可以函数 isNaN 检测 NaN。

值 Infinity 表示所有大于 1.79769313488261570e + 308 的值。

数字拥有方法。JavaScript 有一个对象 Math，它包含一套作用域数字的方法。例如，可以用 Math.floor( number )  方法将一个数字转换成一个整数。

#### 字符串

**字符串字面量可以被包围在单引号或双引号中，它可能包含 0 个或多个字符**。\ (反斜线符号)是转义字符。JavaScript 被创建的时候，Unicode 非一个 16 位的字符集，所以 JavaScript 中的所有字符都是 16 位的。

JavaScript 没有字符类型。要表示一个字符，只须创建仅一个字符的字符串的字面上之外，不大可能在这门语言的程序中出现。在 JavaScript 中，那些字符对也可能出现在正则表达式字面上，所以块注释对于被注释。

转义字符允许把那些正常情况下不被允许的字符插入到字符串，比如反斜线、引号和控制字符。\u 约定允许指定用数字表示的字符码位。

```js
"A" === "\u0041"
```

字符串有一个 length  属性。例如 "seven".length 是 5。

**字符串是不可变的。一旦字符串被创建，就永远无法改变它**。但通过 + 运算符去连接其他的字符串从而得到一个新字符串是很容易的。两个包含着完全相同的字符且字符顺序也相同的字符串被认为是相同的字符串。

```js
'c' + 'a' + 't'  === 'cat'
```

是 true

字符串有一些方法

```
'cat'.toUpperCase() === 'CAT'
```

### 语句

一个编译单元包含一组可执行的语句。**在 web 浏览器中，每个 <script> 标签都被提供一个被编译且立即执行的编译单元。因为缺少链接器，JavaScript 把它们一起抛入一个公共的全局名字空间中。**

**当 var 语句被用在函数的内部时，它定义了这个函数的私有变量。**

switch、while、for 和 do 语句允许有一个可选的前置标签，它配合 break 语句来使用。

**语句往往按照从上而下的顺序被执行。 JavaScript 可以通过条件语句、循环语句、强制跳转语句和函数调用来改变这个执行序列。**

代码块是包在一对花括号的一组语句。不像许多其他的语言，**JavaScript 中的代码块不会创建一个新的作用域，因此变量应该被定义在函数的顶端，而不是在代码块。**

if 语句根据表达式的值改变程序的控制流程，如果表达式的值为真，那么执行 then 代码块，否则，执行可选的 else 分支。

下面列出的值被当作假（false）

- false
- null
- undefined
- 空字符串
- 数字 0
- 数字 NaN

其他所有的值都被当作真，包括 true，字符串 "false"，以及所有的对象。

switch 语句执行一个多路分支。它把其表达式的值和所有指定的 case 条件进行匹配。其表达式可能产生一个数字或字符串。当找到一个精确的匹配时，执行匹配的 case 从句中的语句。如果没有找到任何匹配，则执行可选的 default 语句。

一个 case  从句包含一个或多个 case  表达式，case 表达式不一定必须是常量。为了防止继续执行下一个 case，case 语句后应该跟随一个强跳转语句。你可以用 break 语句去退出一个 switch 语句。

while 语句执行一个简单的循环。如果表达式为假，那么循环终止。而当表示式为真时，代码块将被执行。

for 语句是一个结构更复杂的循环语句，它有两种形式。

常见的形式由三个可选从句控制：初始化从句、条件从句和增量从句。首先，它的作用通常是初始化变量。接着，计算 condition 的值。典型的情况是它根据一个完成条件的检测循环变量。如果 condition 被省略掉，则假定返回的条件是真。如果 condition 的值为假，那么循环将终止。否则，执行代码块，然后执行 increment，接着循环会重复执行 condition。

另一种形式（被称为 for in 语句）会枚举一个对象的所有属性名。在每次循环中，对象的另一个属性名字字符串被赋予值给 for 和 in 之间的变量。

通常你须通过检测 object.hasOwnProperty(variable) 来确定这个属性就是该对象的成员，还是从其原型链里面找到的。

```js
for(myval in obj)
    if (obj.hasOwnproperty(myval)) {
        ……
    }
```

do 语句就像是 while 语句，唯一的区别是它在代码块执行之后而不是之前检测表达式的值。这就意味着代码块将总是执行至少一次。

try 语句执行一个代码块，并捕获该代码块抛出的任何异常，catch 从句定义了一个新的变量，它将接收该异常对象。

throw 语句抛出一个异常。如果 throw 语句在一个 try 代码块中，那么控制权会跳到 catch 从句中。如果 throw 语句在函数中，则该函数调用被放弃，且控制权会跳到调用该函数的 try 语句的 catch 从句中。

throw 语句中的表达式通常是一个对象字面量，它包含一个 name 属性和一个 message 属性。异常捕获器可以使用这些信息去决定该做什么。

return 语句会使一个函数提前返回。它也可以指定要被返回的值。如果没有指定返回表达式，那么其返回值是 undefined。

JavaScript 不允许在 return 关键字和表达式之间换行。

break 语句会使程序退出一个循环语句或 switch 语句。它可以指定一个可选的标签，那将会使程序退出带该标签的语句。

JavaScript 不允许在 break 关键字和标签之间换行。

一个 expression 语句可以给一个或多个变量或成员赋值，或者调用一个方法，或者从对象中删除一个属性。运算符 = 被用于赋值。不要把它和恒等运算符 === 混淆。运算符 += 可以用于加法运算或连接字符串。

### 表达式

最简单的表达式是字面量值、变量、内置的值（ true、false、null、undefined、NaN 和 Infinity），以 new 前导的调用表达式、以 delete 前导的属性存取表达式、包在圆括号中的表达式，以一个前缀运算符作为前导的表达式，或者表达式后面跟着：

- 一个插入运算符与另一个表达式；
- 三元运算符 ？ 后面跟着另一个表达式，然后接一个 : 再然后接第三个表达式。
- 一个函数调用
- 一个属性存取表达式。

三元运算符 ？有三个运算符。如果第一个运算运算数值为真，它产生第二个运算数是值。但是，如果第一个运算数值为假，它会产生第三个运算数的值。

在排列运算符优先极的表中，排在越上面的运算符优先极越高。它们的结合性最强。排在越下面的运算符优先极越低。圆括号可以用来改变正常情况下的有限极，所以：

```js
2 + 3 * 5  === 17
(2 + 3) * 5 === 25
```

| 212                     | 2121               |
| ----------------------- | ------------------ |
| . []  ( )               | 属性存取及函数调用 |
| delete new typeof + - ! | 一元运算符         |
| * / %                   | 乘法、 除法、 取模 |
| + -                     | 加法/连接、 减法   |
| >= <= > <               | 等于运算符         |
| ===  !==                | 等式运算符         |
| &&                      | 逻辑与             |
| \|\|                    | 逻辑或             |
| ?:                      | 三元               |

typeof 运算符产生的值有 'number'、'string'、'boolean'、'undefined'、'function' 和 'object'。如果运算符是一个数组或 null，那么结果是 'object'，这是不对的。

- 如果 ！的运算符的值为真，那么它产生 false，否则，它产生 true。

+ +运算符可以进行加法运算或字符串连接。如果你想要的是加法运算，请确保两个运算数都是数字。
+ / 运算符可能会产生一个非整数结果，即使两个运算数都是整数。
+ 如果第一个运算数的值为假，那么运算符  && 产生它的第一个运算数的值。否则，它产生第二个运算数的值。
+ 如果第一个运算数的值为真，那么运算符 || 产生它的第一个运算符的值。否则，它产生第二个运算数的值。

函数调用引发函数的执行。**函数调用运算符是跟随在函数名后面的一对圆括号**。圆括号中可能包含将会传递给这个函数的参数。

一个属性存取表达式用于指定一个对象或数组的属性或元素。

### 字面量

对象字面量是一种方便指定新对象的表示法。属性名可以是标识符或字符串。这些名字被当作字面量名而不是变量名来对待，所以<u>对象的属性名在编译时才能知道</u>。属性的值就是表达式。

数组字面量是一个方便指定新数组的表示法。

### 函数

函数字面量定义了函数值。**它可以有一个可选的名字，用于递归地调用自己**。它可以指定一个参数列表，这些参数将作为变量由调用时传递的实际参数初始化。

函数的主体包括变量定义和语句。